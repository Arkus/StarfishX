/*Copyright ©1999 Mars SaxmanAll Rights ReservedThis program is free software; you can redistribute it and/ormodify it under the terms of the GNU General Public Licenseas published by the Free Software Foundation; either version 2of the License, or (at your option) any later version.This program is distributed in the hope that it will be useful,but WITHOUT ANY WARRANTY; without even the implied warranty ofMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See theGNU General Public License for more details.You should have received a copy of the GNU General Public Licensealong with this program; if not, write to the Free SoftwareFoundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.Code to manage Starfish's prefs file.This is just some basic IO stuff to write the preferences record todisk and read it back again later.*/#include "preferences.h"#include "macgen.h"	// for the size codes#include <string.h>#include <Files.h>#include <Folders.h>Preferences gPrefs;static SInt16 OpenPrefsFile(void);void PrefsReset(void)	{	/*	Set the prefs to use the default values.	At some point, we will load the values from a file, if present.	*/	gPrefs.size = sizeCodeMedium;	gPrefs.when = whenCodeNever;	gPrefs.interval = 20;	gPrefs.units = intervalCodeMinute;	gPrefs.lastPatternTime = 0;		//January 1, 1904 :-)	gPrefs.hoff = gPrefs.voff = 0;	gPrefs.palette = paletteRandom;	gPrefs.expandedState = false;	// OBSOLETE	gPrefs.windowOpen = true;	gPrefs.colourIntensity = 127;	// OBSOLETE	gPrefs.imageDetail = 127;		// OBSOLETE	gPrefs.fileType = typeCodePICT;	gPrefs.whichMonitor = mainMonitor;	}int LoadPreferences(void)	{	/*	Load the preferences file from disk.	If we loaded it, return true.	Otherwise, we don't touch the gPrefs record, and return false.	*/	short file = OpenPrefsFile();	long length;	if(file > 0)		{		length = sizeof(Preferences);		FSRead(file, &length, &gPrefs);		FSClose(file);		return true;		}	else return false;	}void StorePreferences(void)	{	/*	Write the preferences data to disk.	We store it in a specific file in a specific folder	so we can locate it again on the way back in.	*/	short file = OpenPrefsFile();	long length;	if(file > 0)		{		length = sizeof(Preferences);		FSWrite(file, &length, &gPrefs);		FSClose(file);		}	}static SInt16 OpenPrefsFile(void)	{	/*	Attempt to open the prefs file, read/write.	First, ask the system for a preferences folder.	Then, set the name of our prefs file.	Finally, open it.	If the file does not exist, create it.	If we failed to open the file, return 0 or less.	*/	FSSpec pfile;	short out;	OSErr err;	err = FindFolder(kOnSystemDisk, kPreferencesFolderType, true, &pfile.vRefNum, &pfile.parID);	strcpy((char*)&pfile.name[0], (char*)"\pStarfish Prefs\0");	//Attempt to create the file. We don't care whether this succeeds or fails.	err = FSpCreate(&pfile, 'Stfs', 'pref', 0);	//Now try to open it. Either we just created it, it already existed, or it can't exist.	err = FSpOpenDF(&pfile, fsRdWrPerm, &out);	return out;	}